
import "collatz.ptls" as collatz

-----------------------------------------------------------

output = chart(20, collatz.getSequence(83)) |> println

-----------------------------------------------------------

chart(height, values) =
  if values is Empty then ""
  else
    values
    |> normalize(height)
    |> getRows(height)
    |> join("\n")

-----------------------------------------------------------

normalize(height, values) =
  values
  |> map(mul(height / maximum(values)))
  |> map(max(0))

-----------------------------------------------------------

getRows(height, values) =
  for row in reverse(range(height))
  yield rowChars(row, values) |> join("")

-----------------------------------------------------------

rowChars(row, values) =
  values |> map(getBar(row))

-----------------------------------------------------------

getBar(row, n) = switch {
  case barHeight < 0 and row > 0  " "
  case barHeight < 0 and row <= 0 "_"
  otherwise bars[min(7, toInt(barHeight * 7))] 
} where {barHeight = (n - row); bars = toArray("▁▂▃▄▅▆▇█")}
